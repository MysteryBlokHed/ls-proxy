// ==UserScript==
// @name        ls-proxy
// @descripton  Wrapper around localStorage to easily store JSON objects
// @version     0.5.1
// @author      Adam Thompson-Sharpe
// @license     MIT OR Apache-2.0
// @homepageURL https://gitlab.com/MysteryBlokHed/ls-proxy
// ==/UserScript==
(()=>{"use strict";var e={677:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.keys=(e,t)=>Object.keys(e).every((e=>t.includes(e)))&&t.every((t=>t in e)),e.types=(e,t)=>Object.entries(e).every((([e,r])=>typeof r===t[e]))}(r||(r={})),t.default=r}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.storeSeparate=e.storeObject=e.Validations=void 0;var t=r(677);Object.defineProperty(e,"Validations",{enumerable:!0,get:function(){return t.default}});const n=({checkGets:e,set:t,get:r,parse:s,stringify:n})=>({checkGets:null==e||e,set:null!=t?t:(e,t)=>localStorage[e]=t,get:null!=r?r:e=>{var t;return null!==(t=localStorage[e])&&void 0!==t?t:null},parse:null!=s?s:JSON.parse,stringify:null!=n?n:JSON.stringify}),i=e=>e&&"object"==typeof e&&[Object,Array].includes(e.constructor),o=(e,t,r,s)=>new Proxy(r,{set(r,n,i){const o=Reflect.set(r,n,i);return s(e,t,r,e),o},get(e,t){return i(e[t])?o(e,t,Reflect.get(e,t),this.set):Reflect.get(e,t)}}),a=(e,t)=>"boolean"==typeof e?e?[e]:[e,t]:e[0]?[e[0]]:2===e.length?[e[0],e[1]]:[e[0],t];e.storeObject=function(e,t,r={}){const{checkGets:s,partial:l,set:c,get:f,validate:g,modify:u,parse:d,stringify:y}=(({checkGets:e,partial:t,set:r,get:s,validate:i,modify:o,parse:a,stringify:l})=>Object.assign({partial:null!=t&&t,validate:null!=i?i:()=>!0,modify:null!=o?o:e=>e},n({checkGets:e,set:r,get:s,parse:a,stringify:l})))(r),p=(t,r="set")=>((e,t,r,s,n)=>{const i=new TypeError("get"===s?`Validation failed while parsing ${n} from localStorage`:`Validation failed while setting to ${n} in localStorage`),o=a(e(r,s),i);if(!o[0])throw o[1];return t(r,s)})(g,u,t,r,e),v=e=>{const t=d(e);return p(t,"get")},b=e=>y(p(e)),O=(e,r=!0)=>{let s={};return Object.keys(t).forEach((n=>{var i;return s[n]=r?null!==(i=e[n])&&void 0!==i?i:t[n]:e[n]})),s};let h=Object.assign({},t);const j=f(e);if(j)if(l){const t=d(j);h=O(t);const r=p(h);c(e,y(Object.assign(Object.assign({},t),r)))}else h=v(j);else c(e,b(t));const w={set(t,r,s){const n=Reflect.set(t,r,s);if(l){const r=p(t);c(e,y(Object.assign(Object.assign({},d(f(e))),r)))}else c(e,b(t));return n},get(r,n){var a;return s&&(l?(r[n]=p(O(d(f(e)),!1),"get")[n],p(r,"get")):r[n]=null!==(a=v(f(e))[n])&&void 0!==a?a:t[n],i(r[n]))?o(r,n,r[n],this.set):Reflect.get(r,n)}};return new Proxy(h,w)};e.storeSeparate=function(e,t={}){const{id:r,checkGets:s,set:c,get:f,validate:g,modify:u,parse:d,stringify:y}=(({id:e,checkGets:t,set:r,get:s,validate:i,modify:o,parse:a,stringify:l})=>Object.assign({id:e,validate:null!=i?i:()=>!0,modify:null!=o?o:e=>e},n({checkGets:t,set:r,get:s,parse:a,stringify:l})))(t),p=Object.assign({},e),v=(e,t,r)=>((e,t,r,s,n)=>{const i=new TypeError("get"===s?`Validation failed while parsing ${n} from localStorage`:`Validation failed while setting to ${n} in localStorage`),o=a(e(r,s,n),i);if(!o[0])throw o[1];return t(r,s,n)})(g,u,{[e]:t},r,e)[e];for(const[t,s]of Object.entries(e)){const e=l(t,r),n=f(e);n?p[t]=v(d(n),t,"get"):c(e,y(v(t,s,"set")))}return new Proxy(p,{set(e,t,s){const n=v(t,s,"set");return c(l(t,r),y(n)),Reflect.set(e,t,n)},get(t,n){if(s){const s=f(l(n,r)),i=s?d(s):e[n];t[n]=v(n,i,"get")}return i(t[n])?o(t,n,t[n],this.set):Reflect.get(t,n)}})};const l=(e,t)=>t?`${t}.${e}`:e})(),window.LSProxy=s})();