// ==UserScript==
// @name        ls-proxy
// @descripton  Wrapper around localStorage (and other stores) to easily store JSON objects
// @version     0.6.1
// @author      Adam Thompson-Sharpe
// @license     MIT OR Apache-2.0
// @homepageURL https://gitlab.com/MysteryBlokHed/ls-proxy
// ==/UserScript==
(()=>{"use strict";var e={43:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.react=void 0,t.react=s(410)},410:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.storeStateful=void 0;const r=s(568);t.storeStateful=function(e,t,s={}){const n={},i={};for(const s of Object.keys(e).sort())[n[s],i[s]]=t(e[s]);return(0,r.storeSeparate)(n,Object.assign(Object.assign({},s),{checkGets:!1,checkDefaults:!1,set(e,t){!function(e,t){if(!(e in t))throw new TypeError(`${e} was not passed in defaults object`)}(e,n),i[e](t),n[e]=t},get:()=>null,parse:e=>e,stringify:e=>"object"==typeof e?JSON.parse(JSON.stringify(e)):e}))}},568:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.storeSeparate=t.storeObject=t.Factories=t.Validations=void 0;var r=s(677);Object.defineProperty(t,"Validations",{enumerable:!0,get:function(){return r.default}}),t.Factories=s(43);const n=({checkGets:e,checkDefaults:t,set:s,get:r,parse:n,stringify:i})=>({checkGets:null==e||e,checkDefaults:null==t||t,set:null!=s?s:(e,t)=>localStorage[e]=t,get:null!=r?r:e=>{var t;return null!==(t=localStorage[e])&&void 0!==t?t:null},parse:null!=n?n:JSON.parse,stringify:null!=i?i:JSON.stringify}),i=e=>e&&"object"==typeof e&&[Object,Array].includes(e.constructor),o=(e,t,s,r)=>new Proxy(s,{set(s,n,i){const o=Reflect.set(s,n,i);return r(e,t,s,e),o},get(e,t){return i(e[t])?o(e,t,Reflect.get(e,t),this.set):Reflect.get(e,t)}}),a=(e,t)=>"boolean"==typeof e?e?[e]:[e,t]:e[0]?[e[0]]:2===e.length?[e[0],e[1]]:[e[0],t];t.storeObject=function(e,t,s={}){const{checkGets:r,checkDefaults:c,partial:l,set:f,get:u,validate:g,modify:d,parse:y,stringify:p}=(({checkGets:e,partial:t,set:s,get:r,validate:i,modify:o,parse:a,stringify:c})=>Object.assign({partial:null!=t&&t,validate:null!=i?i:()=>!0,modify:null!=o?o:e=>e},n({checkGets:e,set:s,get:r,parse:a,stringify:c})))(s),v=(t,s="set")=>((e,t,s,r,n)=>{const i=new TypeError("get"===r?`Validation failed while parsing ${n} from localStorage`:`Validation failed while setting to ${n} in localStorage`),o=a(e(s,r),i);if(!o[0])throw o[1];return t(s,r)})(g,d,t,s,e),b=e=>{const t=y(e);return v(t,"get")},h=e=>p(v(e)),O=(e,s=!0)=>{let r={};return Object.keys(t).forEach((n=>{var i;return r[n]=s?null!==(i=e[n])&&void 0!==i?i:t[n]:e[n]})),r};let j=Object.assign({},t);if(c){const s=u(e);if(null===s)f(e,h(t));else if(l){const t=y(s);j=O(t);const r=v(j);f(e,p(Object.assign(Object.assign({},t),r)))}else j=b(s)}return new Proxy(j,{set(t,s,r){const n=Reflect.set(t,s,r);if(l){const s=v(t);f(e,p(Object.assign(Object.assign({},y(u(e))),s)))}else f(e,h(t));return n},get(s,n){var a;return r&&(l?(s[n]=v(O(y(u(e)),!1),"get")[n],v(s,"get")):s[n]=null!==(a=b(u(e))[n])&&void 0!==a?a:t[n],i(s[n]))?o(s,n,s[n],this.set):Reflect.get(s,n)}})};t.storeSeparate=function(e,t={}){const{id:s,checkGets:r,checkDefaults:l,set:f,get:u,validate:g,modify:d,parse:y,stringify:p}=(({id:e,checkGets:t,checkDefaults:s,set:r,get:i,validate:o,modify:a,parse:c,stringify:l})=>Object.assign({id:e,validate:null!=o?o:()=>!0,modify:null!=a?a:e=>e},n({checkGets:t,checkDefaults:s,set:r,get:i,parse:c,stringify:l})))(t),v=Object.assign({},e),b=(e,t,s)=>((e,t,s,r,n)=>{const i=new TypeError("get"===r?`Validation failed while parsing ${n} from localStorage`:`Validation failed while setting to ${n} in localStorage`),o=a(e(s,r,n),i);if(!o[0])throw o[1];return t(s,r,n)})(g,d,{[e]:t},s,e)[e];if(l)for(const[t,r]of Object.entries(e)){const e=c(t,s),n=u(e);null===n?f(e,p(b(t,r,"set"))):v[t]=b(y(n),t,"get")}return new Proxy(v,{set(e,t,r){const n=b(t,r,"set");return f(c(t,s),p(n)),Reflect.set(e,t,n)},get(t,n){if(r){const r=u(c(n,s)),i=r?y(r):e[n];t[n]=b(n,i,"get")}return i(t[n])?o(t,n,t[n],this.set):Reflect.get(t,n)}})};const c=(e,t)=>t?`${t}.${e}`:e},677:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.keys=(e,t)=>Object.keys(e).every((e=>t.includes(e)))&&t.every((t=>t in e)),e.types=(e,t)=>Object.entries(e).every((([e,s])=>typeof s===t[e]))}(s||(s={})),t.default=s}},t={};var s=function s(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,s),i.exports}(568);window.LSProxy=s})();