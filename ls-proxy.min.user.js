// ==UserScript==
// @name        ls-proxy
// @descripton  Wrapper around localStorage to easily store JSON objects
// @version     0.4.0
// @author      Adam Thompson-Sharpe
// @license     MIT OR Apache-2.0
// @homepageURL https://gitlab.com/MysteryBlokHed/ls-proxy
// ==/UserScript==
(()=>{"use strict";var e={677:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.keys=(e,t)=>Object.keys(e).every((e=>t.includes(e)))&&t.every((t=>t in e)),e.types=(e,t)=>Object.entries(e).every((([e,r])=>typeof r===t[e]))}(r||(r={})),t.default=r}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.storeSeparate=e.storeObject=e.Validations=void 0;var t=r(677);Object.defineProperty(e,"Validations",{enumerable:!0,get:function(){return t.default}});const o=e=>e&&"object"==typeof e&&[Object,Array].includes(e.constructor),s=(e,t,r,n)=>new Proxy(r,{set(r,o,s){const l=Reflect.set(r,o,s);return n(e,t,r,e),l},get(e,t){return o(e[t])?s(e,t,Reflect.get(e,t),this.set):Reflect.get(e,t)}});e.storeObject=function(e,t,r={}){const{checkGets:n,partial:a,set:c,get:i,validate:u,modify:f,parse:g,stringify:d}=(({checkGets:e,partial:t,set:r,get:n,validate:o,modify:s,parse:l,stringify:a})=>({checkGets:null==e||e,partial:null!=t&&t,set:null!=r?r:(e,t)=>localStorage[e]=t,get:null!=n?n:e=>{var t;return null!==(t=localStorage[e])&&void 0!==t?t:null},validate:null!=o?o:()=>!0,modify:null!=s?s:e=>e,parse:null!=l?l:JSON.parse,stringify:null!=a?a:JSON.stringify}))(r),y=(t,r="set")=>l(u,f,t,r,e),v=e=>{const t=g(e);return y(t,"get")},p=e=>d(y(e)),b=(e,r=!0)=>{let n={};return Object.keys(t).forEach((o=>{var s;return n[o]=r?null!==(s=e[o])&&void 0!==s?s:t[o]:e[o]})),n};let O=Object.assign({},t);const j=i(e);if(j)if(a){const t=g(j);O=b(t);const r=y(O);c(e,d(Object.assign(Object.assign({},t),r)))}else O=v(j);else c(e,p(t));const h={set(t,r,n){const o=Reflect.set(t,r,n);if(a){const r=y(t);c(e,d(Object.assign(Object.assign({},g(i(e))),r)))}else c(e,p(t));return o},get(r,l){var c;return n&&(a?(r[l]=y(b(g(i(e)),!1),"get")[l],y(r,"get")):r[l]=null!==(c=v(i(e))[l])&&void 0!==c?c:t[l],o(r[l]))?s(r,l,r[l],this.set):Reflect.get(r,l)}};return new Proxy(O,h)};const l=(e,t,r,n,o)=>{const s=new TypeError("get"===n?`Validation failed while parsing ${o} from localStorage`:`Validation failed while setting to ${o} in localStorage`),l=e(r,n);if("boolean"==typeof l){if(!l)throw s}else if(Array.isArray(l)&&!l[0])throw 2===l.length?l[1]:s;return t(r,n)};e.storeSeparate=function(e,t={}){const{id:r,checkGets:n}=(({id:e,checkGets:t})=>({id:e,checkGets:null==t||t}))(t),o=Object.assign({},e);for(const[t,n]of Object.entries(e)){const e=a(t,r);localStorage[e]?o[t]=localStorage[e]:localStorage[e]=n}return new Proxy(o,{set:(e,t,n)=>(localStorage[a(t,r)]=n,Reflect.set(e,t,n)),get(t,o){var s;return n&&(t[o]=null!==(s=localStorage[a(o,r)])&&void 0!==s?s:e[o]),Reflect.get(t,o)}})};const a=(e,t)=>t?`${t}.${e}`:e})(),window.LSProxy=n})();