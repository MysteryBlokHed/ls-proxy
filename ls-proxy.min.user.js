// ==UserScript==
// @name        ls-proxy
// @descripton  Wrapper around localStorage (and other stores) to easily store JSON objects
// @version     0.7.0
// @author      Adam Thompson-Sharpe
// @license     MIT OR Apache-2.0
// @homepageURL https://gitlab.com/MysteryBlokHed/ls-proxy
// ==/UserScript==
(()=>{"use strict";var e={677:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.keys=(e,t)=>Object.keys(e).every((e=>t.includes(e)))&&t.every((t=>t in e)),e.types=(e,t)=>Object.entries(e).every((([e,r])=>typeof r===t[e]))}(r||(r={})),t.default=r}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.storeSeparate=e.storeObject=e.Validations=void 0;var t=r(677);Object.defineProperty(e,"Validations",{enumerable:!0,get:function(){return t.default}});const n=({checkGets:e,checkDefaults:t,mutateProxiedObject:r,set:s,get:n,parse:i,stringify:l})=>({checkGets:null==e||e,checkDefaults:null==t||t,mutateProxiedObject:null==r||r,set:null!=s?s:(e,t)=>localStorage[e]=t,get:null!=n?n:e=>{var t;return null!==(t=localStorage[e])&&void 0!==t?t:null},parse:null!=i?i:JSON.parse,stringify:null!=l?l:JSON.stringify}),i=e=>e&&"object"==typeof e&&[Object,Array].includes(e.constructor),l=(e,t,r,s)=>new Proxy(r,{set(r,n,i){const l=Reflect.set(r,n,i);return s(e,t,r,e),l},get(e,t){return i(e[t])?l(e,t,Reflect.get(e,t),this.set):Reflect.get(e,t)}}),a=(e,t)=>"boolean"==typeof e?e?[e]:[e,t]:e[0]?[e[0]]:2===e.length?[e[0],e[1]]:[e[0],t];e.storeObject=function(e,t,r={}){const{checkGets:s,checkDefaults:c,mutateProxiedObject:o,partial:u,set:f,get:g,validate:d,modify:y,parse:p,stringify:v}=(({checkGets:e,partial:t,set:r,get:s,validate:i,modify:l,parse:a,stringify:c})=>Object.assign({partial:null!=t&&t,validate:null!=i?i:()=>!0,modify:null!=l?l:e=>e},n({checkGets:e,set:r,get:s,parse:a,stringify:c})))(r),b=(t,r="set")=>((e,t,r,s,n)=>{const i=new TypeError("get"===s?`Validation failed while parsing ${n} from localStorage`:`Validation failed while setting to ${n} in localStorage`),l=a(e(r,s),i);if(!l[0])throw l[1];return t(r,s)})(d,y,t,r,e),h=e=>{const t=p(e);return b(t,"get")},O=e=>v(b(e)),j=(e,r=!0)=>{let s={};return Object.keys(t).forEach((n=>{var i;return s[n]=r?null!==(i=e[n])&&void 0!==i?i:t[n]:e[n]})),s};let k=Object.assign({},t);if(c){const r=g(e);if(null===r)f(e,O(t));else if(u){const t=p(r);k=j(t);const s=b(k);f(e,v(Object.assign(Object.assign({},t),s)))}else k=h(r)}return new Proxy(k,{set(t,r,s){const n=!o||Reflect.set(t,r,s);if(u){const r=b(t);f(e,v(Object.assign(Object.assign({},p(g(e))),r)))}else f(e,O(t));return n},get(r,n){var a;if(s){let s=r[n];if(u?(s=r[n]=b(j(p(g(e)),!1),"get")[n],b(r,"get")):s=null!==(a=h(g(e))[n])&&void 0!==a?a:t[n],i(s))return l(r,n,s,this.set);if(!o)return s;r[n]=s}return Reflect.get(r,n)}})};e.storeSeparate=function(e,t={}){const{id:r,checkGets:s,checkDefaults:o,mutateProxiedObject:u,set:f,get:g,validate:d,modify:y,parse:p,stringify:v}=(({id:e,checkGets:t,checkDefaults:r,set:s,get:i,validate:l,modify:a,parse:c,stringify:o})=>Object.assign({id:e,validate:null!=l?l:()=>!0,modify:null!=a?a:e=>e},n({checkGets:t,checkDefaults:r,set:s,get:i,parse:c,stringify:o})))(t),b=Object.assign({},e),h=(e,t,r)=>((e,t,r,s,n)=>{const i=new TypeError("get"===s?`Validation failed while parsing ${n} from localStorage`:`Validation failed while setting to ${n} in localStorage`),l=a(e(r,s,n),i);if(!l[0])throw l[1];return t(r,s,n)})(d,y,{[e]:t},r,e)[e];if(o)for(const[t,s]of Object.entries(e)){const e=c(t,r),n=g(e);null===n?f(e,v(h(t,s,"set"))):b[t]=h(p(n),t,"get")}return new Proxy(b,{set(e,t,s){const n=h(t,s,"set");return f(c(t,r),v(n)),!u||Reflect.set(e,t,n)},get(t,n){let a=t[n];if(s){const t=g(c(n,r)),s=null!==t?p(t):e[n];a=h(n,s,"get")}return i(a)?l(t,n,a,this.set):u?(t[n]=a,Reflect.get(t,n)):a}})};const c=(e,t)=>t?`${t}.${e}`:e})(),window.LSProxy=s})();